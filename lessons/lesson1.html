<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lesson 1: Vocabulary + Reading</title>
  <style>
    body { font-family: calibri; max-width: 800px; margin: auto; line-height: 1.6; padding: 20px; }
    .question { margin-top: 20px; }
    .choices button { margin: 5px; display: block; }
    .result { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

  <h1>üìò Lesson 1: Vocabulary + Reading</h1>

  <div class="question" id="quiz-container"></div>
  <div class="result" id="result"></div>

  <script>
    const text = document.getElementById("text").innerText;

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }

    const questions = [
      // üîπ Part 1: Vocabulary
      {
        id: 1,
        question: "What does 'excessive' mean?",
        choices: ["‰∏≠ÊØí„ÅÆ", "Âøò„Çå„ÇÑ„Åô„ÅÑ", "ÈÅéÂ∫¶„ÅÆ", "ÈÅéÂ∫¶„Å´"],
        answer: 2
        note: "It is reported that excessive use of smartphones may weaken our brain functions."
      },
    {
        id: 2,
        question: "What does 'weaken' mean?",
        choices: ["Âº±„ÅÑ", "„Äú„Çí‰Ωé‰∏ã„Åï„Åõ„Çã", "ÈÄ±", "„Äú„ÇíÁ§∫„Åô"],
        answer: 1
        note: "It is reported that excessive use of smartphones may weaken our brain functions."
      },
      {
        id: 3,
        question: "What does 'demonstrate' mean?",
        choices: ["„Äú„ÇíÂàÜÊûê„Åô„Çã", "„Äú„ÇíÊ∂àÂéª„Åô„Çã", "ÂõûÂæ©„Åô„Çã", "„Äú„ÇíÂÆüË®º„Åô„Çã"],
        answer: 3
      },
      {
        id: 4,
        question: "What does 'whereby' mean?",
        choices: ["‰∏ÄÊñπ„Åß", "„Åù„Çå„Å´„Çà„Å£„Å¶", "ÈùûÂ∏∏„Å´", "ÁõÆÁöÑ„ÇÇ„Å™„Åè"],
        answer: 1
      },
      {
        id: 5,
        question: "What does 'sort' mean?",
        choices: ["„Äú„ÇíÂàÜÈ°û„Åô„Çã", "„Äú„ÇíÁ§∫„Åô", "„Äú„ÇíÂàÜÊûê„Åô„Çã", "„Äú„ÇíÂà∂Èôê„Åô„Çã"],
        answer: 0
      },
      {
        id: 6,
        question: "What does 'addiction' mean?",
        choices: ["ÁîªÈù¢", "ÂØæÁ≠ñ", "‰∏≠ÊØí", "ÁóáÁä∂"],
        answer: 2
      },
      // üîπ Part 2: Brain Overload Reading (from former lesson1)
      {
        id: 4,
        question: "What does excessive use of smartphones do?",
        choices: ["Improve memory", "Weaken brain functions", "Strengthen concentration", "Help sleep better"],
        answer: 1
      },
      {
        id: 5,
        question: "What is described as a necessary tool?",
        choices: ["Books", "TV", "Smartphones", "Glasses"],
        answer: 2
      }
    ];

    let mainPool = [...questions];
    let retryPool = [];
    let answeredLog = {};
    let mistakes = [];

    let currentQuestion = null;

    function getNextQuestion() {
      if (mainPool.length > 0) return mainPool.shift();
      const retryCandidates = retryPool.filter(q => !answeredLog[q.id]);
      if (retryCandidates.length > 0) {
        return retryCandidates[Math.floor(Math.random() * retryCandidates.length)];
      }
      return null;
    }

    function showQuestion() {
      currentQuestion = getNextQuestion();
      if (!currentQuestion) {
        showResult();
        return;
      }

      let html = `<h3>${currentQuestion.question}</h3><div class="choices">`;
      currentQuestion.choices.forEach((choice, i) => {
        html += `<button onclick="checkAnswer(${i})">${choice}</button>`;
      });
      html += "</div>";
      document.getElementById("quiz-container").innerHTML = html;
    }

    function checkAnswer(selected) {
      const q = currentQuestion;
      const resultDiv = document.getElementById("result");

      if (selected === q.answer) {
        answeredLog[q.id] = true;
        resultDiv.innerText = "‚úÖ Correct!";
      } else {
        resultDiv.innerText = "‚ùå Incorrect. Will appear again.";
        if (!retryPool.some(item => item.id === q.id)) retryPool.push(q);
        if (!mistakes.includes(q.id)) mistakes.push(q.id);
      }

      setTimeout(() => {
        resultDiv.innerText = "";
        showQuestion();
      }, 1000);
    }

    function showResult() {
      const total = questions.length;
      const correct = Object.keys(answeredLog).length;
      const score = Math.floor((correct / total) * 100);

      document.getElementById("quiz-container").innerHTML = `
        <h2>üéâ You completed the combined lesson!</h2>
        <p>‚úÖ Score: ${score}%</p>
        <p>‚ùå Mistakes: ${mistakes.length} question(s)</p>
        <a href="../index.html">üîô Back to Top</a>
      `;

      const user = localStorage.getItem("lesson_username") || "default";
      const resultData = {
        score: score,
        mistakes: mistakes
      };
      localStorage.setItem(`${user}_lesson1`, JSON.stringify(resultData));
    }

    showQuestion();
  </script>

</body>
</html>
