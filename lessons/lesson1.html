<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lesson 1: Vocabulary & Comprehension</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: auto;
      line-height: 1.6;
      padding: 20px;
      background-image: url("background.png");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center;
      background-color: #f9f9f9;
    }
    .question { margin-top: 20px; }
    .choices { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .choices button {
      flex: 1 1 45%;
      padding: 15px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
    .choices button:hover { background: #eef; }
    .result { font-weight: bold; margin-top: 10px; }
    #sentence-box { background: #fff8dc; padding: 10px; border-left: 5px solid #ffa500; border-radius: 6px; margin-bottom: 20px; }
  </style>
</head>
<body>

  <h1>üìñ Lesson 1: Vocabulary & Comprehension</h1>
  <div id="sentence-box"></div>
  <div class="question" id="quiz-container"></div>
  <div class="result" id="result"></div>

  <script>
    const questions = [
      { id: 1, question: "What does 'excessive' most nearly mean?", choices: ["Â∞ë„Å™„Åô„Åé„Çã", "Â§ö„Åô„Åé„Çã", "ÊôÆÈÄö„ÅÆ", "ÂÅ•Â∫∑ÁöÑ„Å™"], answer: 1, sentence: "However, it is reported that excessive use of smartphones may weaken our brain functions." },
      { id: 2, question: "What does 'weaken' mean?", choices: ["„Äú„ÇíÂº∑„Åè„Åô„Çã", "„Äú„ÇíÂº±„ÇÅ„Çã", "„Äú„ÇíÁõ¥„Åô", "„Äú„Çí„Å§„Å™„Åê"], answer: 1, sentence: "However, it is reported that excessive use of smartphones may weaken our brain functions." },
      { id: 3, question: "What is the meaning of 'function' in this context?", choices: ["„Éë„Éº„ÉÜ„Ç£„Éº", "Ê¥ªÂãï", "ÁõÆÁöÑ", "Ê©üËÉΩ„ÉªÂÉç„Åç"], answer: 3, sentence: "However, it is reported that excessive use of smartphones may weaken our brain functions." },
      { id: 4, question: "What is a 'symptom'?", choices: ["Ê≤ªÁôÇ", "ÁóáÁä∂", "Ê≤ª„Åô„ÇÇ„ÅÆ", "ÁøíÊÖ£"], answer: 1, sentence: "These symptoms are called \u201cbrain overload\u201d or digital cognitive dysfunction." },
      { id: 5, question: "What does 'overload' mean?", choices: ["‰∏çË∂≥", "ÂÖÖÈõª", "ÈÅéÂä¥", "ÊéÉÈô§"], answer: 2, sentence: "Our brains become overloaded when we use smartphones excessively." },
      { id: 6, question: "What causes cognitive dysfunction according to the passage?", choices: ["Eating unhealthy food", "Sleeping too much", "Overusing smartphones", "Reading books"], answer: 2 },
      { id: 7, question: "What do smartphones give us through texts, images, and videos?", choices: ["Too much information", "Stronger memory", "Clearer thinking", "Better sleep"], answer: 0 }
    ];

    let mainPool = [...questions];
    let retryPool = [];
    let answeredLog = {};
    let mistakes = [];
    let currentQuestion = null;
    let startTime = Date.now();

    function getNextQuestion() {
      if (mainPool.length > 0) return mainPool.shift();
      const retryCandidates = retryPool.filter(q => !answeredLog[q.id]);
      if (retryCandidates.length > 0) {
        return retryCandidates[Math.floor(Math.random() * retryCandidates.length)];
      }
      return null;
    }

    function showQuestion() {
      currentQuestion = getNextQuestion();
      if (!currentQuestion) {
        showResult();
        return;
      }

      document.getElementById("sentence-box").innerText = currentQuestion.sentence || "";

      let html = `<h3>${currentQuestion.question}</h3><div class="choices">`;
      currentQuestion.choices.forEach((choice, i) => {
        html += `<button onclick="checkAnswer(${i})">${choice}</button>`;
      });
      html += `</div>`;
      document.getElementById("quiz-container").innerHTML = html;
    }

    function checkAnswer(selected) {
      const q = currentQuestion;
      const resultDiv = document.getElementById("result");

      if (selected === q.answer) {
        answeredLog[q.id] = true;
        resultDiv.innerText = "‚úÖ Correct!";
      } else {
        resultDiv.innerText = "‚ùå Incorrect. It will appear again.";
        if (!retryPool.some(item => item.id === q.id)) retryPool.push(q);
        if (!mistakes.includes(q.id)) mistakes.push(q.id);
      }

      setTimeout(() => {
        resultDiv.innerText = "";
        showQuestion();
      }, 1000);
    }

    function showResult() {
      const total = questions.length;
      const correct = Object.keys(answeredLog).length;
      const score = Math.floor((correct / total) * 100);
      const elapsed = Math.floor((Date.now() - startTime) / 1000); // in seconds
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;

      document.getElementById("quiz-container").innerHTML = `
        <h2>üéâ You completed the lesson!</h2>
        <p>‚úÖ Score: ${score}%</p>
        <p>‚ùå Mistakes: ${mistakes.length} question(s)</p>
        <p>‚è±Ô∏è Time: ${minutes}m ${seconds}s</p>
        <a href="../index.html">üîô Back to Top</a>
      `;

      const user = localStorage.getItem("lesson_username") || "default";
      const resultData = { score: score, mistakes: mistakes, time: `${minutes}m ${seconds}s` };
      localStorage.setItem(`${user}_lesson1`, JSON.stringify(resultData));
    }

    showQuestion();
  </script>
</body>
</html>
