<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>L.3 - Course Hub</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .section { margin-bottom: 30px; }
    .ranking-table { border-collapse: collapse; width: 100%; }
    .ranking-table th, .ranking-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>L.3 - Learning Dashboard</h1>
  <p id="usernameDisplay"></p>

  <div class="section">
    <h2>Vocabulary Course</h2>
    <a href="l3vocab.html">Go to Vocabulary Course</a>
    <p id="vocabResult"></p>
    <h3>Top 10 - Vocabulary Ranking</h3>
    <table class="ranking-table" id="vocabRanking">
      <tr><th>Rank</th><th>Name</th><th>Score (%)</th><th>Time (sec)</th></tr>
    </table>
  </div>

  <div class="section">
    <h2>Grammar Course</h2>
    <a href="l3grammar.html">Go to Grammar Course</a>
    <p id="grammarResult"></p>
    <h3>Top 10 - Grammar Ranking</h3>
    <table class="ranking-table" id="grammarRanking">
      <tr><th>Rank</th><th>Name</th><th>Score (%)</th><th>Time (sec)</th></tr>
    </table>
  </div>

  <script>
    const username = localStorage.getItem("username") || "Guest";

    document.getElementById("usernameDisplay").textContent = `Logged in as: ${username}`;

    function showUserResult(type) {
      const score = localStorage.getItem(`${username}_${type}_score`);
      const time = localStorage.getItem(`${username}_${type}_time`);
      const resultText = score && time
        ? `Your score: ${score}%, Time: ${time} sec`
        : "You haven't completed this course yet.";

      document.getElementById(`${type}Result`).textContent = resultText;
    }

    function showRanking(type) {
      const table = document.getElementById(`${type}Ranking`);
      const ranking = JSON.parse(localStorage.getItem(`${type}_ranking`) || "[]");

      // Sort by score descending, then time ascending
      ranking.sort((a, b) => {
        if (b.score === a.score) {
          return a.time - b.time;
        }
        return b.score - a.score;
      });

      // Top 10
      const top10 = ranking.slice(0, 10);
      top10.forEach((entry, index) => {
        const row = table.insertRow(-1);
        row.innerHTML = `<td>${index + 1}</td><td>${entry.name}</td><td>${entry.score}</td><td>${entry.time}</td>`;
      });
    }

    // Display current user's results
    showUserResult("vocab");
    showUserResult("grammar");

    // Display top 10 rankings
    showRanking("vocab");
    showRanking("grammar");
  </script>
</body>
</html>
